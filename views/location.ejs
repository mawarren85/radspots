<!DOCTYPE html>
<html class="has-navbar-fixed-top">

<% include partials/header %>

  <body>
    <% include partials/nav %>

      <div class="container is-fluid">
        <div class="columns">

          <!-- ***********************************************************
                  left column
************************************************************** -->

          <aside class="column is-3 top-space">

            <figure class="image is-1by2">
              <% if (spot[0].image) { %>
                <img src="<%= spot[0].image %>">
                <% } else { %>
                  <img src="../images/skatepark-default.png">
                  <% } %>
            </figure>

            <h1 class="title is-3"><%= spot[0].spot_name %></h1>

<!-- ***********************************************************
                  checkin  / upvote buttons
************************************************************** -->

<div class="level">
  <div class="level-item">
            <form class="" action="/users/location" method="post">
              <div class="field">
                <input type="hidden" name="spot_id" value="<%=spot[0].id %>">
                <input type="hidden" name="spot_name" value="<%=spot[0].spot_name %>">
                <input type="hidden" name="checkin" value="true">
                <button class="button is-success is-outlined is-focus" type="submit">Checkin</button>
              </div>
            </form>
          </div>


          <div class="level-item">

            <form class="" action="/users/location" method="post">
              <div class="field">
                <input type="hidden" name="spot_id" value="<%=spot[0].id %>">
                <input type="hidden" name="spot_name" value="<%=spot[0].spot_name %>">
                <input type="hidden" name="upvote" value="1">
                <button class="button is-success is-outlined is-focus" type="submit">Upvote</button>
              </div>
            </form>
</div>
  </div>

            <p class="subtitle is-6">
              <%= spot[0].spot_location %>
            </p>


            <div class="level">
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Upvotes</p>
                  <p class="title">
                    <%= spot[0].upvotes %>
                  </p>
                </div>
              </div>
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Checkins</p>
                  <% var count = 0 %>
                  <% if (checkins) { %>

                  <% checkins.forEach(function(checkin) { %>
                    <% if (checkin.spot_id === spot[0].id) { %>
                        <% count++ %>
                    <% } %>
                    <%  })  %>
                    <p class="title"><%= count %> </p>
                    <%  } else { %>
                  <p class="title"><%= count %> </p>
                  <% } %>
                </div>
              </div>
              <div class="level-item has-text-centered">
                <div>
                  <p class="heading">Sketchness</p>
                  <p class="title">
                    <%= spot[0].sketch_level %>
                  </p>
                </div>
              </div>
            </div>




<!-- ***************************************************
                          Map
******************************************************** -->

            <!-- map styles to be moved to css -->
            <div id="map" style="width: 200px; height: 200px">
              <style>
                .marker {
                  background-image: url('../images/skater.png');
                  background-size: cover;
                  width: 35px;
                  height: 35px;
                  border-radius: 50%;
                  /* cursor: pointer; */
                }
              </style>

              <!-- reassign feature variable passed in to points variable so it can be accessed in script tags below -->
              <script>
                var points = <%- feature %>
              </script>
            </div>


            <script>
              // create new map ...options to set center point to where the map starts out

              mapboxgl.accessToken = "pk.eyJ1IjoibWF3YXJyZW4iLCJhIjoiY2piZmdlODFuMnlzejJycGU2amoxdG44NyJ9.GlbjGsu0VqzCls45AniQgw";

              var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v9',
                center: points.features[0].geometry.coordinates,
                zoom: 13
              });

              // track user location

              map.addControl(new mapboxgl.GeolocateControl({
                positionOptions: {
                  enableHighAccuracy: true
                },
                trackUserLocation: true
              }));




              /* add a layer to the map that consists of the point location information in geoJSON format */
              map.on('load', function(e) {

                map.addLayer({
                  "id": "locations",
                  "type": "symbol",
                  // geoJSON object containing location coordinates
                  "source": {
                    "type": "geojson",
                    "data": points // data passed in from map route (feature)
                  },
                  "layout": {
                    // can set icon image here
                    "icon-image": "icon",
                    "icon-allow-overlap": true,
                  }
                })

              });
              //});

              var nav = new mapboxgl.NavigationControl();
              //map.addControl(nav, 'top-left');
              // add markers to map
              points.features.forEach(function(marker) {

                // create a HTML element for each feature
                var el = document.createElement('div');
                el.className = 'marker';

                // make a marker for each feature and add to the map
                new mapboxgl.Marker(el)
                  .setLngLat(marker.geometry.coordinates)
                  .addTo(map);
              });
            </script>


          </aside>

<!-- ***********************************************************
          right column
************************************************************** -->

          <div class="column is-8 is-offset-1">


            <div class="tabs is-left" id="nav-tabs">
              <ul>
                <a>
                  <li id="photos">Photos</li>
                </a>
                <a>
                  <li id="videos">Videos</li>
                </a>
                <a>
                  <li id="checkins">Checkins</li>
                </a>
                <a>
                  <li id="feed">Feed</li>
                </a>
                <a>
                  <li id="add-comment">Speak</li>
                </a>
                <a>
                  <li id="comments">Comments</li>
                </a>

              </ul>
            </div>


<!-- ***********************************************************
          tab content to be displayed/hidden on click
************************************************************** -->

            <div class="get-content">
              <div class="photos hidden">HEYO THIS IS PHOTOS CONTENT LALLALALALALALALALLALALALAALLALALALALALLALALALALALALAL"</div>
              <div class="videos hidden">HEYO THIS IS VIDEOS CONTENT"</div>
<!-- ***********************************************************
              tab content // show checkins
************************************************************** -->
              <div class="checkins hidden">
              <% if (checkins) { %>
              <% checkins.forEach(function(checkin) { %>
                <% if (checkin.spot_id === spot[0].id) { %>
                <div class="tile is-ancestor">
                  <div class="tile is-parent is-vertical is-8">
                    <div class="tile box is-child">
                      <h3 class="title is-5">

                    <%= checkin.full_name %> Checked In %></h3>
                    <h3 class="subtitle is-6"><%= checkin.updated_at %></h3>


                    </div>
                  </div>
                </div>
                <% } %>
                <%  })  %>
                <%  }  %>
                </div>

<!-- ***********************************************************
                    tab content // show spot feed
************************************************************** -->
              <div class="feed hidden">

                <% comments.forEach(function(comment) { %>
                  <div class="tile is-ancestor">
                    <div class="tile is-parent is-vertical is-8">
                      <div class="tile box is-child">
                        <h3 class="title is-5">

                      <%= comment.full_name %>
                    </h3>
                        <p>
                          <%= comment.comment %>
                      </div>
                    </div>
                  </div>
                  <%  })  %>









                <% if (checkins) { %>
                <% checkins.forEach(function(checkin) { %>
                  <% if (checkin.spot_id === spot[0].id) { %>
                  <div class="tile is-ancestor">
                    <div class="tile is-parent is-vertical is-8">
                      <div class="tile box is-child">
                        <h3 class="title is-5">

                      <%= checkin.full_name %> Checked In %></h3>
                      <h3 class="subtitle is-6"><%= checkin.updated_at %></h3>


                      </div>
                    </div>
                  </div>
                  <% } %>
                  <%  })  %>
                  <%  }  %>





              </div>


<!-- ***********************************************************
                tab content // post a comment
************************************************************** -->

              <div class="add-comment hidden">

                <form class="" action="/users/location" method="post">

                  <div class="field">
                    <label class="label"><%= user[0].full_name %>, what are your thoughts?</label>
                    <div class="control">
                      <textarea class="textarea" id="comment" name="comment" placeholder="Comments..."></textarea>
                      <input type="hidden" name="spot_id" value="<%=spot[0].id %>">
                      <input type="hidden" name="spot_name" value="<%=spot[0].spot_name %>">
                    </div>
                  </div>


                  <div class="control">
                    <button class="button is-success is-outlined is-focus" type="submit">Add Comment</button>
                  </div>

                </form>
              </div>

<!-- ***********************************************************
                tab content // show comments
************************************************************** -->
              <div class="comments hidden">

                <% comments.forEach(function(comment) { %>
                  <div class="tile is-ancestor">
                    <div class="tile is-parent is-vertical is-8">
                      <div class="tile box is-child">
                        <h3 class="title is-5">

                      <%= comment.full_name %>
                    </h3>
                        <p>
                          <%= comment.comment %>
                      </div>
                    </div>
                  </div>
                  <%  })  %>





              </div>

            </div>

          </div>



        </div>
      </div>



      <% include partials/footer %>
  </body>

</html>
