<!DOCTYPE html>
<html>
<% include partials/header %>

<body>

<h1>HOOOOOORAYYYYYY YOU BE LOGGED INNNNN</h1>
<h2>profile page</h2>
<p>user:
  <%= user[0].full_name %>
</p>
<p>email:
  <%= user[0].email %>
</p>
<a href="success">Click me!</a>

<!-- MAAAAPPPPP -->

<!-- map styles to be moved to css -->
<div id="map" style="width: 500px; height: 500px">
  <style>
    .marker {
      background-image: url('../images/skater.png');
      background-size: cover;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
    }

    .mapboxgl-popup {
      max-width: 200px;
    }

    .mapboxgl-popup-content {
      text-align: center;
      font-family: 'Open Sans', sans-serif;
    }
  </style>


</div>

<script>
  //reassign feature variable passed in to points variable so it is accessible in the script tag below
  var points = <%- feature %>
</script>

<script>
  // create new map ...options to set center point to where the map starts out

  mapboxgl.accessToken = "pk.eyJ1IjoibWF3YXJyZW4iLCJhIjoiY2piZmdlODFuMnlzejJycGU2amoxdG44NyJ9.GlbjGsu0VqzCls45AniQgw";

  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v9',
    center: [-97.7431, 30.2672],
    zoom: 10
  });

  // track user location

  map.addControl(new mapboxgl.GeolocateControl({
    positionOptions: {
      enableHighAccuracy: true
    },
    trackUserLocation: true
  }));




  /* add a layer to the map that consists of the point location information in geoJSON format */
  map.on('load', function(e) {

    map.addLayer({
      "id": "locations",
      "type": "symbol",
      // geoJSON object containing location coordinates
      "source": {
        "type": "geojson",
        "data": points // data passed in from map route (feature)
      },
      "layout": {
        // can set icon image here
        "icon-image": "icon",
        "icon-allow-overlap": true,
      }
    })

  });


  var nav = new mapboxgl.NavigationControl();
  map.addControl(nav, 'top-left');


  // add markers to map
  points.features.forEach(function(marker) {

    // create a HTML element for each feature
    var el = document.createElement('div');
    el.className = 'marker';

    let name = marker.properties.name
    console.log(name)

    // make a marker for each feature and add to the map
    new mapboxgl.Marker(el)
      .setLngLat(marker.geometry.coordinates)
    new mapboxgl.Marker(el)
      .setLngLat(marker.geometry.coordinates)
      // add a popup for the marker
      .setPopup(new mapboxgl.Popup({
          offset: 25
        }) // add popup text
        .setHTML('<form action="location" method="post">' + '<h3>' + marker.properties.name + '</h3>' + '<input type="hidden" name="spot_name" value="' + name + '"/>' + '<p>' + marker.properties.address + '</p>' +
          '<input type="submit" value="More Info" />' + '</form>'))

      .addTo(map);
  });
</script>





<% include partials/footer %>
</body>

</html>
